import{u as n}from"./SnakeGamePage-ac29bb5e.js";import"./index-4cb06891.js";import"./ContentSection-cd16a23d.js";function f(c){return class extends c.Scene{constructor(){super({key:"SnakeScene"}),this.boardSize=20,this.cellSize=24,this.snake=[],this.food={x:0,y:0},this.direction={x:0,y:-1},this.speedMs=150,this.score=0,this.timer=null,this.started=!1}init(){this.game.events.on("resize",this.resize,this),this.cursors=this.input.keyboard.createCursorKeys()}create(){var t;try{console.debug("[SnakeScene] create() called")}catch{}this.input.on("pointerdown",this.handlePointerDown,this),this.input.on("pointermove",this.handlePointerMove,this),this.input.on("pointerup",this.handlePointerUp,this);try{const e=this.sys&&this.sys.canvas;e&&e.addEventListener&&(this.__domPointerDown=s=>{const i=e.getBoundingClientRect();return this.handlePointerDown({event:s,x:s.clientX-i.left,y:s.clientY-i.top})},this.__domPointerMove=s=>{const i=e.getBoundingClientRect();return this.handlePointerMove({event:s,x:s.clientX-i.left,y:s.clientY-i.top})},this.__domMouseMove=s=>{const i=e.getBoundingClientRect();return this.handlePointerMove({event:s,x:s.clientX-i.left,y:s.clientY-i.top})},this.__domMouseUp=s=>{const i=e.getBoundingClientRect();return this.handlePointerUp({event:s,x:s.clientX-i.left,y:s.clientY-i.top})},e.addEventListener("pointerdown",this.__domPointerDown),e.addEventListener("pointermove",this.__domPointerMove),e.addEventListener("mousemove",this.__domMouseMove),e.addEventListener("mouseup",this.__domMouseUp))}catch{}(t=this.input.keyboard)==null||t.on("keydown",e=>{if(!this.started)return;switch((e.key||"").toLowerCase()){case"arrowup":case"w":this.setDirection({x:0,y:-1});break;case"arrowdown":case"s":this.setDirection({x:0,y:1});break;case"arrowleft":case"a":this.setDirection({x:-1,y:0});break;case"arrowright":case"d":this.setDirection({x:1,y:0});break}}),this.graphics=this.add.graphics(),this.resize({width:this.sys.canvas.width,height:this.sys.canvas.height})}resetGame(){this.snake=[{x:10,y:10}],this.direction={x:0,y:-1},this.food=this.generateFood(),this.score=0,n.getState().setScore(0),n.getState().setRunning(!1),n.getState().setPaused(!1),n.getState().setHighScore(n.getState().highScore)}startGame(){this.resetGame(),this.timer&&this.timer.remove(),this.timer=this.time.addEvent({delay:this.speedMs,loop:!0,callback:this.tick,callbackScope:this}),this.started=!0,n.getState().setRunning(!0),n.getState().setPaused(!1);try{console.debug("[SnakeScene] startGame() started",{score:this.score,boardSize:this.boardSize,speedMs:this.speedMs})}catch{}}pauseGame(){this.timer&&(this.timer.paused=!0),n.getState().setPaused(!0),n.getState().setRunning(!1)}resumeGame(){this.timer&&(this.timer.paused=!1),n.getState().setPaused(!1),n.getState().setRunning(!0)}stopGame(){this.timer&&(this.timer.remove(),this.timer=null),n.getState().setRunning(!1),n.getState().setPaused(!1),this.started=!1}setBoardSize(t){!Number.isInteger(t)||t<5||(this.boardSize=t,this.resize({width:this.sys.canvas.width,height:this.sys.canvas.height}))}generateFood(){const{snake:t}=this,e=500;let s=0;for(;s++<e;){const i={x:c.Math.Between(0,this.boardSize-1),y:c.Math.Between(0,this.boardSize-1)};if(!t.some(o=>o.x===i.x&&o.y===i.y))return i}return{x:0,y:0}}tick(){const t={...this.snake[0]};t.x+=this.direction.x,t.y+=this.direction.y;const e=t.x<0||t.x>=this.boardSize||t.y<0||t.y>=this.boardSize,s=this.snake.some(i=>i.x===t.x&&i.y===t.y);if(e||s){this.gameOver();return}this.snake.unshift(t),t.x===this.food.x&&t.y===this.food.y?(this.score+=10,n.getState().addScore(10),this.speedMs=Math.max(80,this.speedMs-5),this.food=this.generateFood(),this.events.emit("ateFood",this.score)):this.snake.pop(),this.events.emit("update",{snake:this.snake,food:this.food,score:this.score}),this.draw()}draw(){if(!this.graphics)return;this.graphics.clear();const t=this.cellSize||Math.floor(Math.min(this.sys.canvas.width,this.sys.canvas.height)/this.boardSize);this.graphics.fillStyle(725537,1),this.graphics.fillRect(0,0,this.sys.canvas.width,this.sys.canvas.height),this.graphics.lineStyle(1,16777215,.03);for(let e=0;e<=this.boardSize;e++)this.graphics.lineBetween(e*t,0,e*t,t*this.boardSize),this.graphics.lineBetween(0,e*t,t*this.boardSize,e*t);this.graphics.fillStyle(16765286,1),this.graphics.fillCircle(this.food.x*t+t/2,this.food.y*t+t/2,t*.3),this.snake.forEach((e,s)=>{this.graphics.fillStyle(s===0?440020:561586,1),this.graphics.fillRoundedRect(e.x*t+2,e.y*t+2,t-4,t-4,s===0?4:2)})}setDirection(t){const e=this.direction;e.x+t.x===0&&e.y+t.y===0||(this.direction=t)}gameOver(){n.getState().setRunning(!1),n.getState().setPaused(!1),n.getState().setScore(this.score);const t=n.getState();this.score>t.highScore&&t.setHighScore(this.score),this.events.emit("gameOver",this.score),this.scene.pause()}handlePointerDown(t){const e=this.sys&&this.sys.canvas?this.sys.canvas.getBoundingClientRect():{left:0,top:0},s=typeof t.x=="number"&&!Number.isNaN(t.x)?t.x:t.event&&t.event.clientX-e.left||0,i=typeof t.y=="number"&&!Number.isNaN(t.y)?t.y:t.event&&t.event.clientY-e.top||0;try{console.debug("[SnakeScene] pointerDown",{px:s,py:i,pointer:t})}catch{}try{typeof window<"u"&&window.__PHASER_DEBUG__&&(window.__PHASER_LAST_POINTER_EVENT={type:"down",pointerEvent:t.event||null,px:s,py:i})}catch{}this.pointerDownPos={x:s,y:i}}handlePointerMove(t){if(!this.pointerDownPos)return;const e=this.sys&&this.sys.canvas?this.sys.canvas.getBoundingClientRect():{left:0,top:0},s=typeof t.x=="number"&&!Number.isNaN(t.x)?t.x:t.event&&t.event.clientX-e.left||0,i=typeof t.y=="number"&&!Number.isNaN(t.y)?t.y:t.event&&t.event.clientY-e.top||0,o=s-this.pointerDownPos.x,h=i-this.pointerDownPos.y,a=Math.abs(o)>Math.abs(h)?{x:o>0?1:-1,y:0}:{x:0,y:h>0?1:-1};try{console.debug("[SnakeScene] pointerMove",{dx:o,dy:h,newDir:a,pointer:t})}catch{}this.setDirection(a);try{this.events&&this.events.emit("pointerDirection",this.direction)}catch{}try{typeof window<"u"&&window.__PHASER_DEBUG__&&(window.__PHASER_LAST_POINTER_EVENT={type:"move",pointerEvent:t.event||null,px:s,py:i,dx:o,dy:h,newDir:a})}catch{}try{typeof window<"u"&&window.__PHASER_DEBUG__&&(window.__PHASER_LAST_POINTER_DIR=this.direction)}catch{}this.pointerDownPos=null}handlePointerUp(t){this.pointerDownPos=null;try{typeof window<"u"&&window.__PHASER_DEBUG__&&(window.__PHASER_LAST_POINTER_EVENT={type:"up",pointerEvent:t.event||null})}catch{}}processSimulatedSwipe({dx:t=0,dy:e=0}={}){try{try{console.debug("[SnakeScene] processSimulatedSwipe",{dx:t,dy:e})}catch{}const s=this.sys&&this.sys.canvas?this.sys.canvas.getBoundingClientRect():{left:0,top:0,width:100,height:100},i=s.width/2,o=s.height/2,h={event:{clientX:s.left+i,clientY:s.top+o}};this.handlePointerDown(h);const a={event:{clientX:s.left+i+t,clientY:s.top+o+e}};this.handlePointerMove(a),this.handlePointerUp(a)}catch{}}resize(t){const e=t.width,s=t.height,i=typeof window<"u"&&window.devicePixelRatio?Math.min(window.devicePixelRatio,2):1,o=this.sys&&this.sys.canvas&&this.sys.canvas.clientWidth?this.sys.canvas.clientWidth:Math.round(e/i),h=this.sys&&this.sys.canvas&&this.sys.canvas.clientHeight?this.sys.canvas.clientHeight:Math.round(s/i),a=Math.floor(Math.min(o,h)/this.boardSize);this.cellSize=Math.max(8,Math.round(a*i)),this.draw()}update(){}shutdown(){try{const t=this.sys&&this.sys.canvas;t&&this.__domPointerDown&&t.removeEventListener("pointerdown",this.__domPointerDown),t&&this.__domPointerMove&&t.removeEventListener("pointermove",this.__domPointerMove),t&&this.__domMouseMove&&t.removeEventListener("mousemove",this.__domMouseMove),t&&this.__domMouseUp&&t.removeEventListener("mouseup",this.__domMouseUp)}catch{}}}}export{f as default};
