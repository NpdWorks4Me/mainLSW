import{r as f,j as t,P as A,m as S,T as _,a as w,A as T,ao as I,ay as k,e as L,B as v,$ as C}from"./index-4cb06891.js";import{c as N}from"./customSupabaseClient-9feeeb8f.js";import{T as F}from"./textarea-3805077a.js";import{A as O,a as X,b as Y}from"./avatar-d804221d.js";import{S as z}from"./send-874865a4.js";import{t as d,c as R,g as P,e as E,a as M,d as D,f as b}from"./en-US-aebfe1f7.js";import{H}from"./heart-cb4b81dd.js";import"./supabase-b91ac978.js";function j(s,a){const e=d(s),r=d(a),n=e.getTime()-r.getTime();return n<0?-1:n>0?1:n}function B(s){return R(s,Date.now())}function U(s,a){const e=d(s),r=d(a),n=e.getFullYear()-r.getFullYear(),o=e.getMonth()-r.getMonth();return n*12+o}function q(s){return a=>{const r=(s?Math[s]:Math.trunc)(a);return r===0?0:r}}function W(s,a){return+d(s)-+d(a)}function $(s){const a=d(s);return a.setHours(23,59,59,999),a}function G(s){const a=d(s),e=a.getMonth();return a.setFullYear(a.getFullYear(),e+1,0),a.setHours(23,59,59,999),a}function J(s){const a=d(s);return+$(a)==+G(a)}function K(s,a){const e=d(s),r=d(a),n=j(e,r),o=Math.abs(U(e,r));let c;if(o<1)c=0;else{e.getMonth()===1&&e.getDate()>27&&e.setDate(30),e.setMonth(e.getMonth()-n*o);let i=j(e,r)===-n;J(d(s))&&o===1&&j(s,r)===1&&(i=!1),c=n*(o-Number(i))}return c===0?0:c}function Q(s,a,e){const r=W(s,a)/1e3;return q(e==null?void 0:e.roundingMethod)(r)}function V(s,a,e){const r=P(),n=(e==null?void 0:e.locale)??r.locale??E,o=2520,c=j(s,a);if(isNaN(c))throw new RangeError("Invalid time value");const i=Object.assign({},e,{addSuffix:e==null?void 0:e.addSuffix,comparison:c});let m,u;c>0?(m=d(a),u=d(s)):(m=d(s),u=d(a));const h=Q(u,m),g=(M(u)-M(m))/1e3,l=Math.round((h-g)/60);let p;if(l<2)return e!=null&&e.includeSeconds?h<5?n.formatDistance("lessThanXSeconds",5,i):h<10?n.formatDistance("lessThanXSeconds",10,i):h<20?n.formatDistance("lessThanXSeconds",20,i):h<40?n.formatDistance("halfAMinute",0,i):h<60?n.formatDistance("lessThanXMinutes",1,i):n.formatDistance("xMinutes",1,i):l===0?n.formatDistance("lessThanXMinutes",1,i):n.formatDistance("xMinutes",l,i);if(l<45)return n.formatDistance("xMinutes",l,i);if(l<90)return n.formatDistance("aboutXHours",1,i);if(l<D){const x=Math.round(l/60);return n.formatDistance("aboutXHours",x,i)}else{if(l<o)return n.formatDistance("xDays",1,i);if(l<b){const x=Math.round(l/D);return n.formatDistance("xDays",x,i)}else if(l<b*2)return p=Math.round(l/b),n.formatDistance("aboutXMonths",p,i)}if(p=K(u,m),p<12){const x=Math.round(l/b);return n.formatDistance("xMonths",x,i)}else{const x=p%12,y=Math.trunc(p/12);return x<3?n.formatDistance("aboutXYears",y,i):x<9?n.formatDistance("overXYears",y,i):n.formatDistance("almostXYears",y+1,i)}}function Z(s,a){return V(s,B(s),a)}const ee=s=>({alien:"https://horizons-cdn.hostinger.com/68470a32-d856-4001-aa04-6ef3f0b873ca/a7364cbc02a10924a2ba2e519ad328c1.png",goth:"https://horizons-cdn.hostinger.com/68470a32-d856-4001-aa04-6ef3f0b873ca/7d29636c2dee30bef33f936605597e75.png",princess:"https://horizons-cdn.hostinger.com/68470a32-d856-4001-aa04-6ef3f0b873ca/01da06f6a11f2c65fe53dee161a5c841.png",dino:"https://horizons-cdn.hostinger.com/68470a32-d856-4001-aa04-6ef3f0b873ca/bbf550d0526deab2d870a274ed64e574.png",baby:"https://horizons-cdn.hostinger.com/68470a32-d856-4001-aa04-6ef3f0b873ca/b58f9a1c2f53252f97bc6677f0104419.png"})[s]||"",te=({onStorySubmitted:s})=>{const{user:a}=I(),{openAuthModal:e}=k(),[r,n]=f.useState(""),[o,c]=f.useState(""),[i,m]=f.useState(!1),{toast:u}=L(),h=async g=>{if(g.preventDefault(),!r.trim()||!o.trim()){u({variant:"destructive",title:"Oops!",description:"Please fill out both title and story."});return}if(!a){e("login");return}m(!0);const{error:l}=await N.from("user_stories").insert([{title:r,content:o,user_id:a.id,status:"pending"}]);m(!1),l?u({variant:"destructive",title:"Error submitting story",description:l.message}):(u({title:"Story Submitted!",description:"Thank you for sharing! Your story is now pending review."}),n(""),c(""),s&&s())};return a?t.jsxs(S.form,{onSubmit:h,className:"space-y-6 glass-card p-6 md:p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[t.jsx("h2",{className:"text-2xl font-bold gradient-text text-center",children:"Share Your Story"}),t.jsx("div",{className:"space-y-2",children:t.jsx(C,{value:r,onChange:g=>n(g.target.value),placeholder:"Your Story's Title",maxLength:"100",disabled:i,className:"text-lg"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(F,{value:o,onChange:g=>c(g.target.value),placeholder:"Tell us your story... (max 1000 characters)",rows:8,maxLength:"1000",disabled:i}),t.jsxs("p",{className:"text-xs text-right text-foreground/60",children:[o.length," / 1000"]})]}),t.jsx("div",{className:"text-center",children:t.jsx(v,{type:"submit",disabled:i||!r.trim()||!o.trim(),size:"lg",variant:"cta",children:i?t.jsxs(t.Fragment,{children:[t.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"})," Submitting..."]}):t.jsxs(t.Fragment,{children:["Submit Story ",t.jsx(z,{className:"w-4 h-4 ml-2"})]})})})]}):t.jsxs("div",{className:"text-center p-6 glass-card",children:[t.jsx("p",{className:"text-foreground/80 mb-4",children:"Want to share your own story? Log in to join our community showcase!"}),t.jsx(v,{onClick:()=>e("login"),variant:"cta",children:"Log In to Share"})]})},se=({story:s,index:a})=>{const[e,r]=f.useState(null);f.useEffect(()=>{(async()=>{if(!s.user_id)return;const{data:c}=await N.from("profiles").select("nickname, avatar_url").eq("id",s.user_id).single();r(c)})()},[s.user_id]);const n=o=>!o||o==="Anonymous"?"A":o.charAt(0).toUpperCase();return t.jsxs(S.div,{className:"glass-card p-6 flex flex-col",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:a*.1},children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsxs(O,{className:"h-10 w-10 shrink-0 border-2 border-purple-300",children:[t.jsx(X,{src:ee(e==null?void 0:e.avatar_url),alt:e==null?void 0:e.nickname}),t.jsx(Y,{children:n(e==null?void 0:e.nickname)})]}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"font-bold text-foreground",children:(e==null?void 0:e.nickname)||"Anonymous"}),t.jsx("p",{className:"text-xs text-foreground/60",children:Z(new Date(s.created_at),{addSuffix:!0})})]})]}),t.jsx("h3",{className:"text-xl font-bold mb-2 gradient-text",children:s.title}),t.jsx("p",{className:"text-foreground/90 flex-grow",children:s.content}),t.jsx("div",{className:"mt-4 pt-4 border-t border-white/10 flex justify-end",children:t.jsxs(v,{variant:"ghost",size:"sm",className:"text-pink-400 hover:text-pink-300",children:[t.jsx(H,{className:"w-4 h-4 mr-2"})," Like"]})})]})},ue=()=>{const[s,a]=f.useState([]),[e,r]=f.useState(!0),n=f.useCallback(async()=>{r(!0);const{data:o,error:c}=await N.from("user_stories").select("*").eq("status","approved").order("created_at",{ascending:!1});c?console.error("Error fetching stories:",c):a(o),r(!1)},[]);return f.useEffect(()=>{n()},[n]),t.jsxs("div",{className:"py-10",children:[t.jsx(A,{title:"Community Stories",description:"Read and share personal stories from the Little Space World community. A place for connection, understanding, and shared experiences.",canonical:"/stories"}),t.jsxs(S.div,{className:"max-w-4xl mx-auto text-center mb-12 px-4",initial:{opacity:0,y:-30},animate:{opacity:1,y:0},transition:{duration:.7},children:[t.jsx("div",{className:"inline-block bg-purple-300/20 p-3 rounded-full mb-4",children:t.jsx(_,{className:"w-8 h-8 text-purple-300"})}),t.jsx("h1",{className:"text-2xl md:text-4xl font-semibold gradient-text leading-tight mb-4",children:"Community Stories"}),t.jsx("p",{className:"text-lg text-foreground/80 max-w-2xl mx-auto",children:"A collection of heartfelt stories and experiences from our wonderful community."})]}),t.jsxs("div",{className:"max-w-4xl mx-auto px-4 space-y-12",children:[t.jsx(te,{onStorySubmitted:n}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-center mb-8",children:"Read Our Stories"}),e?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx(w,{className:"h-16 w-16 text-white animate-spin"})}):s.length>0?t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:t.jsx(T,{children:s.map((o,c)=>t.jsx(se,{story:o,index:c},o.id))})}):t.jsx("div",{className:"text-center py-16 text-foreground/60 glass-card",children:t.jsx("p",{children:"No stories have been shared yet. Be the first to share yours! âœ¨"})})]})]})]})};export{ue as default};
